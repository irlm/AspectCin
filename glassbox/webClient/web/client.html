<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 
<head>
<title>Glassbox</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<!--[if IE]>
<link href='css/style_ms.css' rel='stylesheet' type='text/css'>
<![endif]-->
<![if !IE]>
<link href='css/style.css' rel='stylesheet' type='text/css'>
<![endif]>

<script type='text/javascript' src='js/Base.js'></script>
<script type='text/javascript' src='js/Logging.js'></script>
<script type='text/javascript' src='dwr/engine.js'></script>
<script type='text/javascript' src='dwr/util.js'></script>
<script type='text/javascript' src='js/overlib.js'></script>
<script type='text/javascript' src='js/overlib_crossframe.js'></script>
<script type='text/javascript' src='dwr/interface/OperationHelper.js'></script>
<script type='text/javascript' src='js/troubleshooter.js'></script>
<script type='text/javascript'>
 
/*********************************************************************
*Calls resets the child iframes.
*
*/

function startup() {
    DWREngine.setErrorHandler(errorHandler);
    DWREngine.setTimeout(10000); // don't allow big request queues to build up 
    configureHint("refreshStatisticsButton", "Refresh Glassbox Analysis");
    configureHint("getDocumentationButton", "Get Documentation");
    // disabled until the email button is enabled
    //configureHint("getEmailButton", "Send an Email of this Operation analysis.");
    configureHint("showConnectionsButton", "Show Connection Configuration Panel");
    configureHint("goHelpButton", "Get Help");
    hideLeftBox();
    
    issueUpdateRequest();
}

function issueUpdateRequest() {
   OperationHelper.updateCheck(updateResponse);
      
   timerID = setTimeout("issueUpdateRequest()", 11000);
}

function resetUI() {
    this.contentarea.reset();
    this.tablebody.reset();
}

//TODO: prompt for which agents to reset
function resetStats() {
    OperationHelper.reset(resetUI); 
}

function updateResponse(update) {
  if(timerID) {
    clearTimeout(timerID);
  }   
  
  if (update.automatically) {
    $("contentarea").src="http://www.glassbox.com/glassbox/Client.do?"+update.version;
  } else {
    var updateLink=$("contentarea").contentWindow.document.getElementById("updateLink"); // yowsa!
    updateLink.href = updateLink.href+"&"+update.version;
  }
  if (update.glassboxTitle !== null) {
    document.title = update.glassboxTitle;
    $("titleHolder").innerHTML = update.glassboxTitle;
  }
}

function refreshStats() {
     //resetUI();
     //refreshOperationsTable(); // not yet implemented!
}

/*********************************************************************
*Connects to all the agents.
*
*/
function connectToAllAgents() {
   showLeftBox();
}

/*********************************************************************
*Shows the left panel
*
*/
function showLeftBox() {
  
 var leftBox = $("troubleshooterLeftPanel");
   leftBox.style.visibility = 'visible';
   leftBox.style.left = "80%";
   leftBox.style.width  = "18%";
   leftBox.style.height  = "90%";

   var mainBox = $("troubleshooterPanel");
   mainBox.style.width="75%";
   mainBox.style.left="2%";
   window.updateConnectionPanel();
}

window.isLeftBoxVisible = function() {
  return $("troubleshooterLeftPanel").style.visibility == 'visible';
};

/*********************************************************************
*Hides the left panel.
*
*/
function hideLeftBox() {
    hideBox("troubleshooterLeftPanel");
    var mainBox = $("troubleshooterPanel");
    mainBox.style.width="95%";
    mainBox.style.left="2%";
}

//
//This is ugly. We need DWR callbacks.  Closures are necessary to pass data...
//
var emailConfigured = false;
var sendViaGlassbox = false;
function emailEvent(eventName, event) {
  if(eventName == "show") {
     if(emailConfigured) {
         showEmail("sendEmail", event);           
     } else {
        showEmail("emailConfiguration",event);
     }
   } else if(eventName =="hide") {
     hideEmail("sendEmail",event);
   } else if(eventName =="hideConfig") {
     hideEmail("emailConfiguration",event);
   } else if(eventName =="configure") {
      //MailHelper.configure();      
      hideEmail("emailConfiguration",event);
      emailConfigured = true;
      showEmail("sendEmail", event);
   } else if(eventName =="send") {
      hideEmail("sendEmail", event);
      //send:
      if(sendViaGlassbox) {
          //Send...
      }
   } else if(eventName =="sendViaGlassbox") {
      hideEmail("emailConfiguration", event);
      sendViaGlassbox = true;
      showEmail("sendEmail", event);      
   }     
}

/** Email popup control **/
function showEmail(panelName, event) {  
    document.getElementById(panelName).style.left=event.clientX;
    document.getElementById(panelName).style.top=event.clientY;
    document.getElementById(panelName).style.visibility="visible";
}

function hideEmail(panelName, event) {
    document.getElementById(panelName).style.visibility="hidden";
}

</script>

</head>

<body style="height: 80%" onload="javascript:startup();">
<!--script type="text/javascript" src="js/wz_dragdrop.js"></script-->

<div id="overDiv" style="position:absolute; visibility:hidden; z-index:1000;"></div>

<div id="sendEmail" style="position:absolute; border=1px;background-color:#D0D0D0; visibility:hidden; z-index:1000;">
<form>
    <table>
        <tr>
	     <td colspan="2">
	      Email this Operation Summary
	     </td>
	</tr>
	<tr>
	     <td>
	       To:
	     </td>
	     <td>
	       <input type="text" name="to" value="">
	     </td>
	</tr>
	<tr>
	  <td>
	    From:
	  </td>
	  <td>
	    <input type="text" name="to" value="">
	  </td>
	</tr>
       <tr>
	 <td  align="center">
	   <a onclick="javascript:emailEvent('send',event);">Send</a>
	 </td>
	 <td  align="center">
	   <a onclick="javascript:emailEvent('hide',event);">Cancel</a>
	 </td>
       </tr>
</table>
</form>
</div>

<div id="emailConfiguration" style="position:absolute; border=1px;background-color:#D0D0D0; visibility:hidden; z-index:1000;">
<form>
    <table>
        <tr>
	     <td colspan="2">
	      Configure Email to use your SMTP server, or send via the Glassbox mail server.
              <br/>
	      <br/><a onclick="javascript:emailEvent('sendViaGlassbox',event);">Send Using Glassbox Server</a>
	      <br/>
	     </td>
	</tr>
	<tr>
	     <td colspan="2">
              <br/>
	      <br/>Or:
	      <br/>
	     </td>
	</tr>
	<tr>
	     <td colspan="2">
	      Configure Email to use your SMTP server:
	     </td>
	</tr>
	<tr>
	     <td>
	       SMTP Server:
	     </td>
	     <td>
	       <input type="text" name="smtp" value="">
	     </td>
	</tr>
	<tr>
	  <td>
	    Username:
	  </td>
	  <td>
	    <input type="text" name="username" value="">
	  </td>
	</tr>
        <tr>
	  <td>
	    Password:
	  </td>
	  <td>
	    <input type="text" name="password" value="">
	  </td>
	</tr>
       <tr>
	 <td  align="center">
	   <a onclick="javascript:emailEvent('configure',event);">Next</a>
	 </td>
	 <td  align="center">
	   <a onclick="javascript:emailEvent('hideConfig',event);">Cancel</a>
	 </td>
       </tr>
</table>
</form>
</div>


    
        <div id="troubleshooterLeftPanel" name="troubleshooterLeftPanel" class="clientLeftDiv" style="visibility:hidden">
	    <table class="troubleshooterLeftPanelTable">                
		<tr class="panelBar"><td></td></tr>
                <tr class="troubleshooterLeftTableRow" height="100%">
		    <td height="100%"><iframe height="100%" scrolling="no" frameborder="0" name="connections" id="connections" src="ConnectionPanel.form" class="connectionPanelIFrame"></iframe></td>
		</tr>
        <tr>
		</tr>
                <tr class="panelBar"><td></td></tr> 	    	        
	    </table>
        </div>
        
	<div id="troubleshooterPanel" name="troubleshooterPanel" class="clientMainDiv" style="background-color;">
	    <table class="troubleshooterPanelTable">
               <tr class="troubleshooterTableMenuRow">
		  <td class="clientMainColumn">
		      <table class="menuTableHead" >
		      <tr class="panelBar"><td colspan="3"></td></tr>
                      <tr><td>
		        <table class="menuTableHead">
			    <tbody id="menuTableHead">
			        <tr class="menuTableHead">
				    <td>
				      <img src="images/glassboxtmfinalheader.jpg">					
			           </td>
				   <td width="100%">
				      &nbsp;<span class="menuTableHead">&nbsp;<font size="+1" id="titleHolder">Glassbox Troubleshooter</font></span>
			           </td>
				    <td align="right">
					<a onclick="javascript:showLeftBox()" alt="Show Connections">
					    <img src="images/connections.jpg" id="showConnectionsButton">
					</a>
				   </td>	
				   
				   <td align="right">
				      <a onclick="javascript:refreshStats()" href="" alt="Refresh Statistics" >
			          <img src="images/refresh.jpg" id="refreshStatisticsButton">
					  </a>
			       </td>	
				   
				   
				    <td align="right">
				        <a href="http://www.glassbox.com/glassbox/Download.do?mediaItemId=173">
			                  <img src="images/documentation32.jpg" id="getDocumentationButton">
   					    </a>
			        </td>

				<!-- NOT QUITE YET....-->    
		                <!-- td align="right">
				        <a onclick="javascript:emailEvent('show', event);">
			                  <img src="images/email32.jpg" id="getEmailButton">
   					    </a>
			        </td -->
			          
			          
	
				    <td align="right">
				        <a href="http://www.glassbox.com/glassbox/HelpSimple.html" target="_blank">
			                  <img src="images/help32.jpg" id="goHelpButton">
					</a>
			          </td>	 		  
				  </tr>
			    </tbody>
			</table>
			</td>
			<td align="right">
			<table class="menuTableHead">
			    <tbody id="menuTableHead">
			        <tr class="menuTableHead">

			        
     				<!--
				    <td align="right">
				  		<img src="images/red-failure.jpg" onclick="javascript:parent.hideLeftBox()"  id="closePanelButton">
				  	</td>
				  	-->
				  	
				  	
				  </tr>
			    </tbody>
			</table>
			</td>
			</tr>
			</table>
		     
                   </td>
		</tr>	
	        <tr class="troubleshooterTableDividerRow">
		    <td class="divider"></td>
		</tr>
	        <tr class="troubleshooterTableHeadRow">
		    <td><iframe scrolling="no" frameborder="0" name="tableheader" id="tableheader" src="OperationHead.form" class="headDiv"></iframe></td>
		</tr>
		<tr class="troubleshooterTableDividerRow">
		    <td class="divider"></td>
		</tr>	    
	        <tr class="troubleshooterTableBodyRow">
		    <td class="troubleshooterBodyTableCol"><iframe  frameborder="0" name="tablebody" id="tablebody" src="OperationBody.form" class="bodyIFrame"></iframe></td>
		</tr>
		<tr class="troubleshooterTableDividerRow">
		    <td class="divider"></td>
		</tr>
		<tr class="troubleshooterContentTableRow">                  
		    <td class="troubleshooterContentTableCol">
		    	<iframe frameborder="0" name="contentarea" id="contentarea" src="welcome.html" class="contentIFrame"></iframe>
	    	</td>		  
		</tr>

	        
               <tr class="panelBar"><td></td></tr>            
	    </table>
	</div>

    <script type="text/javascript">
    <!--

    //SET_DHTML("troubleshooterLeftPanel"+SCALABLE, "troubleshooterPanel"+SCALABLE);
    //SET_DHTML("tableDivider"+VERTICAL);
    //-->
    </script>

    </body>
</html>